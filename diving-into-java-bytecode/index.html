<!DOCTYPE html> <!-- Type on Strap jekyll theme v2.0.0 Copyright 2016-2019 Sylhare Theme free for personal and commercial use under the MIT license https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE --> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"> <!-- CSS --> <link rel="stylesheet" href="/assets/css/main.css"> <!--Favicon--> <link rel="shortcut icon" href="/assets/favicon.png" type="image/x-icon"> <!-- Canonical --> <link rel="canonical" href="https://tech-lessons.in/diving-into-java-bytecode/"> <!-- KaTeX 0.8.3 --> <!-- if you have any issue check https://github.com/KaTeX/KaTeX --> <!-- Google Analytics --> <!-- End Google Analytics --> <!-- seo tags --> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Diving into Java Bytecode | tech-lessons.in</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="Diving into Java Bytecode" /> <meta name="author" content="Sarthak Makhija" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Java code is compiled into an intermediate representation called ‚Äúbytecode‚Äù. It is this bytecode which gets executed by JVM and is later converted into machine specific instructions by JIT compiler. With this article, we attempt to dive into bytecode and understand the internals of various bytecode operations." /> <meta property="og:description" content="Java code is compiled into an intermediate representation called ‚Äúbytecode‚Äù. It is this bytecode which gets executed by JVM and is later converted into machine specific instructions by JIT compiler. With this article, we attempt to dive into bytecode and understand the internals of various bytecode operations." /> <link rel="canonical" href="https://tech-lessons.in/diving-into-java-bytecode/" /> <meta property="og:url" content="https://tech-lessons.in/diving-into-java-bytecode/" /> <meta property="og:site_name" content="tech-lessons.in" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2021-04-04T00:00:00+05:30" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Diving into Java Bytecode" /> <script type="application/ld+json"> {"url":"https://tech-lessons.in/diving-into-java-bytecode/","headline":"Diving into Java Bytecode","dateModified":"2021-04-04T00:00:00+05:30","datePublished":"2021-04-04T00:00:00+05:30","author":{"@type":"Person","name":"Sarthak Makhija"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tech-lessons.in/diving-into-java-bytecode/"},"description":"Java code is compiled into an intermediate representation called ‚Äúbytecode‚Äù. It is this bytecode which gets executed by JVM and is later converted into machine specific instructions by JIT compiler. With this article, we attempt to dive into bytecode and understand the internals of various bytecode operations.","@type":"BlogPosting","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> <!-- Manual seo tags --> <!-- <title>Diving into Java Bytecode | tech-lessons.in</title> <meta name="description" content="Java code is compiled into an intermediate representation called "bytecode". It is this bytecode which gets executed by JVM and is later converted into machi..."> --> </head> <script defer=true src="/assets/js/main.min.js"></script> <body> <header class="site-header"> <!-- Toggle menu --> <nav class="clear"> <a aria-label="pull" id="pull" class="toggle" href="#"> <i class="fa fa-bars fa-lg"></i> </a> <!-- Brand Logo --> <a class="navbar-brand" href="/"> <img src="/assets/img/pexels/logo.png" alt="tech-lessons" title="tech-lessons"> </a> <!-- Menu --> <ul class="hide"> <li class="separator"> |</li> <li> <a class="clear" aria-label="Home" title="Home" href="/"> <i class="fa fa-fw fa-home" aria-hidden="true"></i> Home </a> </li> <li class="separator"> |</li> <li> <a class="clear" aria-label="Search" title="Search" href="/search/"> <i class="fa fa-fw fa-search" aria-hidden="true"></i> Search </a> </li> <li class="separator"> |</li> <li> <a class="clear" aria-label="Tags" title="Tags" href="/tags/"> <i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags </a> </li> <li class="separator"> |</li> <li> <a class="clear" aria-label="About Me" title="About Me" href="/about/"> <i class="fa fa-fw fa-male" aria-hidden="true"></i> About Me </a> </li> </ul> </nav> </header> <div class="content"> <meta property="og:url" content="/diving-into-java-bytecode/" /> <meta property="og:type" content="article" /> <meta property="og:title" content="Diving into Java Bytecode" /> <meta property="og:description" content="Java code is compiled into an intermediate representation called &quot;bytecode&quot;. It is this bytecode which gets executed by JVM and is later converted into machine specific instructions by JIT compiler. With this article, we attempt to dive into bytec..." /> <meta property="og:image" content="assets/img/pexels/diving-into-java-bytecode.png" /> <article class="feature-image"> <header id="main" style=""></header> <section class="post-content"> <h1 id="Diving+into+Java+Bytecode" class="title">Diving into Java Bytecode</h1> <blockquote class="wp-block-quote"> <p>Java code is compiled into an intermediate representation called "bytecode". It is this bytecode which gets executed by JVM and is later converted into machine specific instructions by JIT compiler. With this article, we attempt to dive into bytecode and understand the internals of various bytecode operations.</p> </blockquote> <p>This article aims to cover the following topics -</p> <h3 id="content">Content</h3> <ol> <li>Terminology</li> <li>Quick overview of class file structure</li> <li>Bytecode execution model</li> <li>Introducing bytecode opcodes</li> <li>Opcodes for object creation</li> <li>Combining things together</li> <li>Summary</li> <li>References</li> </ol> <p>Let‚Äôs get an understanding of some terms before we start to dive in.</p> <h3 id="terminology">Terminology</h3> <p><strong>Bytecode</strong></p> <p>An intermediate representation of Java code which JVM understands.</p> <blockquote class="wp-block-quote"> <p>This intermediate representation is called bytecode because each "opcode" is represented by 1 byte. This effectively means, a total of 256 opcodes are possible.</p> </blockquote> <p>These opcodes may take arguments and arguments can be up to 2 bytes long. This means a bytecode instruction which is a combination of an opcode and arguments could be as long as 3 bytes.</p> <p>We will see various opcodes as we move on, but let‚Äôs take a quick glimpse of an instruction which is an output from <strong>javap</strong> utility -</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="mi">9</span><span class="o">:</span> <span class="n">iconst_0</span></code></pre></figure> <ul> <li>iconst_0 is an opcode which pushes a constant value 0 on top of the stack</li> <li>Every opcode is prefixed with a letter like <code class="language-plaintext highlighter-rouge">i</code> / <code class="language-plaintext highlighter-rouge">d</code> etc to represent the data type that opcode is dealing with</li> <li>Every bytecode instruction will start with an offset <em>(9: in the previous example)</em>. This comes handy when a ‚Äúgoto‚Äù opcode is used</li> </ul> <p><strong>javap</strong></p> <p>Standard Java class file disassembler distributed with JDK. It provides a human-readable format of class file.</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">javap</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">c</span> <span class="o">&lt;</span><span class="n">path</span> <span class="n">to</span> <span class="n">the</span> <span class="kd">class</span> <span class="nc">file</span><span class="o">&gt;</span>

<span class="o">-</span><span class="n">p</span> <span class="o">=&gt;</span> <span class="n">display</span> <span class="kd">private</span> <span class="n">methods</span>
<span class="o">-</span><span class="n">v</span> <span class="o">=&gt;</span> <span class="n">be</span> <span class="n">verbose</span>
<span class="o">-</span><span class="n">c</span> <span class="o">=&gt;</span> <span class="n">disassemble</span> <span class="n">the</span> <span class="n">source</span> <span class="n">code</span></code></pre></figure> <h3 id="quick-overview-of-class-file-structure">Quick overview of class file structure</h3> <p>Let‚Äôs take a quick look at the structure of the class file. Don‚Äôt worry if something is not clear at this stage, it should become clear as we proceed with examples. Let‚Äôs take a simple example to understand what constitutes our class file.</p> <p>(<em>Please note: bytecode is trimmed for the entire article</em>).</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="kd">public</span> <span class="kd">class</span> <span class="nc">SumOfN</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">n</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">SumOfN</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">sum</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">//code left out</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure> <p><strong>bytecode</strong></p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">SumOfN</span> <span class="kd">implements</span> <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">Serializable</span>
    <span class="n">minor</span> <span class="nl">version:</span> <span class="mi">0</span>
    <span class="n">major</span> <span class="nl">version:</span> <span class="mi">59</span>
    <span class="nl">flags:</span> <span class="o">(</span><span class="mh">0x0031</span><span class="o">)</span> <span class="no">ACC_PUBLIC</span><span class="o">,</span> <span class="no">ACC_FINAL</span><span class="o">,</span> <span class="no">ACC_SUPER</span>
    <span class="nl">this_class:</span> <span class="err">#</span><span class="mi">8</span>                          <span class="c1">// org/sample/SumOfN</span>
    <span class="nl">super_class:</span> <span class="err">#</span><span class="mi">2</span>                         <span class="c1">// java/lang/Object</span>
    <span class="nl">interfaces:</span> <span class="mi">1</span><span class="o">,</span> <span class="nl">fields:</span> <span class="mi">1</span><span class="o">,</span> <span class="nl">methods:</span> <span class="mi">2</span><span class="o">,</span> <span class="nl">attributes:</span> <span class="mi">1</span>
<span class="nc">Constant</span> <span class="nl">pool:</span>
    <span class="err">#</span><span class="mi">2</span> <span class="o">=</span> <span class="nc">Class</span>              <span class="err">#</span><span class="mi">4</span>             <span class="c1">// java/lang/Object</span>
    <span class="err">#</span><span class="mi">4</span> <span class="o">=</span> <span class="nc">Utf8</span>               <span class="n">java</span><span class="o">/</span><span class="n">lang</span><span class="o">/</span><span class="nc">Object</span>
    <span class="err">#</span><span class="mi">8</span> <span class="o">=</span> <span class="nc">Class</span>              <span class="err">#</span><span class="mi">10</span>            <span class="c1">// org/sample/SumOfN</span>
    <span class="err">#</span><span class="mi">10</span> <span class="o">=</span> <span class="nc">Utf8</span>              <span class="n">org</span><span class="o">/</span><span class="n">sample</span><span class="o">/</span><span class="nc">SumOfN</span></code></pre></figure> <p><strong>Magic number (0xCAFEBABE)</strong> is what every class file starts with. The first four bytes indicate that it is a class file and, the remaining four bytes indicate the minor and major versions used to compile the source file.</p> <p><strong>Major and minor version</strong> indicate the version of JDK used to compile the source file. In the previous example minor version is 0 and major version is 59 (which is Java SE 15).</p> <p><strong>Flags</strong> indicate the modifiers that are applied to the class. In the previous example, we have ACC_PUBLIC indicating it is a public class, ACC_FINAL indicating it is a final class, ACC_SUPER exists for backward compatibility for the code compiled by Sun‚Äôs older compilers for the Java programming language. (More on this <a href="https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6527033">here</a>)</p> <p><strong>Constant pool</strong> Is a part of class file which contains -</p> <ul> <li>string literals / constants</li> <li>doubles/float values</li> <li>names of classes</li> <li>interfaces</li> <li>fields</li> </ul> <p>which are used in a class. Various opcodes like <strong>invokevirtual</strong> refer to constant pool entry to identify the virtual method to be invoked.</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="mi">1</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">7</span>  <span class="c1">// Method run:()Ljava/lang/Object;</span></code></pre></figure> <p>Here, <strong>invokevirtual</strong> takes an argument which refers to an entry in the constant pool and, the entry indicates the method to be called along with its parameter and return type.</p> <p><strong>this_class</strong> refers to an entry (#8) in the constant pool, which in turn refers to another entry (#10) in the pool that returns <code class="language-plaintext highlighter-rouge">org/sample/SumOfN</code>. Effectively, <strong>this_class</strong> holds the name of the current class.</p> <p><strong>super_class</strong> refers to an entry (#2) in the constant pool, which in turn refers to another entry (#4) in the pool that returns <code class="language-plaintext highlighter-rouge">java.lang.Object</code> Effectively, <strong>super_class</strong> holds the name of the super class.</p> <p><strong>interfaces, fields, methods</strong> respectively indicate the number of interfaces implemented by the class, number of fields that the class holds and the number of methods that the class has.</p> <p><strong>attributes</strong> are used in the class file, field level information, method information, and code attribute structures. One example of an attribute is <code class="language-plaintext highlighter-rouge">Exceptions</code> which indicates which checked exceptions a method may throw. This attribute is attached to <code class="language-plaintext highlighter-rouge">method_info</code> structure.</p> <p>This was a very quick overview of class file structure, for more details please check <a href="https://docs.oracle.com/javase/specs/jvms/se16/html/jvms-4.html">this</a> link.</p> <h3 id="bytecode-execution-model">Bytecode execution model</h3> <p>JVM operates using stack as its execution model. Stack is a collection of frames, each of which is allocated when a method is invoked.</p> <p>A stack frame consists of -</p> <p><strong>Operand Stack</strong> Most of the opcodes operate by pushing-in or popping-out value to or from the operand stack. Eg; <strong>iconst_0</strong> pushes 0 on top of the stack.</p> <p><strong>LocalVariableTable (an array of local variables)</strong> In order to allow a variable to be assigned a value, a local variable table is used. <code class="language-plaintext highlighter-rouge">LocalVariableTable</code> is a simple data structure which contains the name of the variable, its data type, its slot along with some other fields.</p> <p>LocalVariableTable contains -</p> <ul> <li>variables that are local to a method</li> <li>method parameters</li> <li><code class="language-plaintext highlighter-rouge">this</code>, if the method is not static. <code class="language-plaintext highlighter-rouge">this</code> is allocated slot 0 in LocalVariableTable</li> </ul> <p>Eg; <strong>istore_1</strong> is an opcode which stores an integer value into LocalVariableTable at slot 1 by picking value from top of the stack.</p> <h3 id="introducing-bytecode-opcodes">Introducing bytecode opcodes</h3> <p>Let‚Äôs take a simple example which adds 2 integers, to understand opcodes and their execution.</p> <p><strong>AdditionExample</strong></p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AdditionExample</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">addend</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">augend</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">addend</span> <span class="o">+</span> <span class="n">augend</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure> <p><strong>bytecode (AdditionExample)</strong></p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AdditionExample</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">AdditionExample</span><span class="o">();</span>
        <span class="nl">Code:</span>
            <span class="mi">0</span><span class="o">:</span> <span class="n">aload_0</span>
            <span class="mi">1</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="mi">1</span>   <span class="c1">// Method java/lang/Object."&lt;init&gt;":()V</span>
            <span class="mi">4</span><span class="o">:</span> <span class="k">return</span>
    
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">execute</span><span class="o">();</span>
        <span class="nl">Code:</span>
          <span class="n">stack</span><span class="o">=</span><span class="mi">2</span><span class="o">,</span> <span class="n">locals</span><span class="o">=</span><span class="mi">3</span><span class="o">,</span> <span class="n">args_size</span><span class="o">=</span><span class="mi">1</span>
            <span class="mi">0</span><span class="o">:</span> <span class="n">bipush</span>        <span class="mi">10</span>
            <span class="mi">2</span><span class="o">:</span> <span class="n">istore_1</span>
            <span class="mi">3</span><span class="o">:</span> <span class="n">bipush</span>        <span class="mi">20</span>
            <span class="mi">5</span><span class="o">:</span> <span class="n">istore_2</span>
            <span class="mi">6</span><span class="o">:</span> <span class="n">iload_1</span>
            <span class="mi">7</span><span class="o">:</span> <span class="n">iload_2</span>
            <span class="mi">8</span><span class="o">:</span> <span class="n">iadd</span>
            <span class="mi">9</span><span class="o">:</span> <span class="n">ireturn</span>

        <span class="nl">LocalVariableTable:</span>
        <span class="nc">Start</span>  <span class="nc">Length</span>  <span class="nc">Slot</span>  <span class="nc">Name</span>     <span class="nc">Signature</span>
            <span class="mi">0</span>      <span class="mi">10</span>     <span class="mi">0</span>  <span class="k">this</span>     <span class="nc">Lorg</span><span class="o">/</span><span class="n">sample</span><span class="o">/</span><span class="nc">AdditionExample</span><span class="o">;</span>
            <span class="mi">3</span>       <span class="mi">7</span>     <span class="mi">1</span>  <span class="n">addend</span>   <span class="no">I</span>
            <span class="mi">6</span>       <span class="mi">4</span>     <span class="mi">2</span>  <span class="n">augend</span>   <span class="no">I</span>
<span class="o">}</span></code></pre></figure> <p>The bytecode of <code class="language-plaintext highlighter-rouge">AdditionExample()</code> should become clear as we move on but first let‚Äôs understand the bytecode of <code class="language-plaintext highlighter-rouge">execute</code> method -</p> <ol> <li>The Java compiler has indicated the depth of stack needed during the execution of this method. <code class="language-plaintext highlighter-rouge">stack=2</code> means at any point during this method execution we will have a maximum of 2 entries on the stack. <code class="language-plaintext highlighter-rouge">locals=3</code> indicate that there are 3 local variables which will need to go in LocalVariableTable. One variable is <code class="language-plaintext highlighter-rouge">addend</code>, other is <code class="language-plaintext highlighter-rouge">augend</code> and the last is <code class="language-plaintext highlighter-rouge">this</code>. <code class="language-plaintext highlighter-rouge">args_size=1</code> indicates one object needs to be initialized before the method call, which again is <code class="language-plaintext highlighter-rouge">this</code></li> <li><strong>bipush</strong> is an opcode which pushes a byte sized integer on the stack. It takes an argument which is 10 in our case</li> <li><strong>istore_1</strong> takes the value from top of the stack, which is 10 and assigns it into LocalVariableTable at slot 1. This opcode removes the value from stack top</li> <li><strong>bipush</strong> now pushes 20 to the top of the stack</li> <li><strong>istore_2</strong> takes the value from top of the stack, which is 20 and assigns it into LocalVariableTable at slot 2</li> <li>At this stage, values 10 and 20 have been assigned to addend and augend in LocalVariableTable, and our stack is empty. This means these 2 values need to be brought into stack before an addition can be performed</li> <li><strong>iload_1</strong> copies the value from slot 1 of LocalVariableTable to the stack</li> <li><strong>iload_2</strong> copies the value from slot 2 of LocalVariableTable to the stack</li> <li>Stack now contains 10 and 20. <strong>iadd</strong> pops 2 integer values from top 2 positions of the stack and sums them up. It stores the result back in the stack top</li> <li><strong>ireturn</strong> takes the value from stack top and returns an integer</li> </ol> <p>Following diagram represents the overall execution -</p> <div class="wp-block-image is-style-default"> <img style="padding-left: 0; max-width: 125%" src="/assets/img/pexels/addition-example.png" class="wp-image-878" /> </div> <p></p> <p>Few things to note-</p> <ul> <li>All the opcodes are prefixed with an <code class="language-plaintext highlighter-rouge">i</code>, indicating that we are dealing with an integer data type</li> <li>Slot 0 of LocalVariableTable is occupied by <code class="language-plaintext highlighter-rouge">this</code> of AdditionExample</li> <li>All the entries in LocalVariableTable are statically typed</li> <li>Bytecode is statically typed in a sense that all the opcodes which work with specific data type</li> </ul> <p>Quick summary of opcodes that we have seen so far -</p> <table> <thead> <tr> <th>Opcode</th> <th>Purpose</th> </tr> </thead> <tbody> <tr> <td>istore_slot</td> <td>Takes an integer value from top of the stack and assigns it into LocalVariableTable at defined slot</td> </tr> <tr> <td>iload_slot</td> <td>Copies the value from defined slot of LocalVariableTable to the stack</td> </tr> <tr> <td>bipush</td> <td>Pushes a byte sized integer on the stack</td> </tr> </tbody> </table> <p>Let‚Äôs take another example, which is a slight modification of the first one. The idea is to invoke a method from another method.</p> <p><strong>MethodInvocation</strong></p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AdditionExample</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">add</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">add</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">addend</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">augend</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">addend</span> <span class="o">+</span> <span class="n">augend</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure> <p><strong>bytecode (MethodInvocation)</strong></p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AdditionExample</span> <span class="o">{</span>
<span class="nc">Constant</span> <span class="nl">pool:</span>
    <span class="err">#</span><span class="mi">7</span> <span class="o">=</span> <span class="nc">Methodref</span>          <span class="err">#</span><span class="mi">8</span><span class="o">.</span><span class="err">#</span><span class="mi">9</span>          <span class="c1">// org/sample/AdditionExample.add:()I</span>
    <span class="err">#</span><span class="mi">8</span> <span class="o">=</span> <span class="nc">Class</span>              <span class="err">#</span><span class="mi">10</span>            <span class="c1">// org/sample/AdditionExample</span>
    <span class="err">#</span><span class="mi">9</span> <span class="o">=</span> <span class="nc">NameAndType</span>        <span class="err">#</span><span class="mi">11</span><span class="o">:</span><span class="err">#</span><span class="mi">12</span>        <span class="c1">// add:()I</span>
    <span class="err">#</span><span class="mi">10</span> <span class="o">=</span> <span class="nc">Utf8</span>              <span class="n">org</span><span class="o">/</span><span class="n">sample</span><span class="o">/</span><span class="nc">AdditionExample</span>
    <span class="err">#</span><span class="mi">11</span> <span class="o">=</span> <span class="nc">Utf8</span>              <span class="n">add</span>
    <span class="err">#</span><span class="mi">12</span> <span class="o">=</span> <span class="nc">Utf8</span>              <span class="o">()</span><span class="no">I</span>

    <span class="kd">public</span> <span class="nf">AdditionExample</span><span class="o">();</span>
        <span class="nl">Code:</span>
            <span class="mi">0</span><span class="o">:</span> <span class="n">aload_0</span>
            <span class="mi">1</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="mi">1</span>    <span class="c1">// Method java/lang/Object."&lt;init&gt;":()V</span>
            <span class="mi">4</span><span class="o">:</span> <span class="k">return</span>
        
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">execute</span><span class="o">();</span>
        <span class="nl">Code:</span>
            <span class="mi">0</span><span class="o">:</span> <span class="n">aload_0</span>
            <span class="mi">1</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">7</span>   <span class="c1">// Method add:()I</span>
            <span class="mi">4</span><span class="o">:</span> <span class="n">ireturn</span>
    
    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">add</span><span class="o">();</span>
        <span class="nl">Code:</span>
            <span class="mi">0</span><span class="o">:</span> <span class="n">bipush</span>        <span class="mi">10</span>
            <span class="mi">2</span><span class="o">:</span> <span class="n">istore_1</span>
            <span class="mi">3</span><span class="o">:</span> <span class="n">bipush</span>        <span class="mi">20</span>
            <span class="mi">5</span><span class="o">:</span> <span class="n">istore_2</span>
            <span class="mi">6</span><span class="o">:</span> <span class="n">iload_1</span>
            <span class="mi">7</span><span class="o">:</span> <span class="n">iload_2</span>
            <span class="mi">8</span><span class="o">:</span> <span class="n">iadd</span>
            <span class="mi">9</span><span class="o">:</span> <span class="n">ireturn</span>
<span class="o">}</span></code></pre></figure> <p>Bytecode in <code class="language-plaintext highlighter-rouge">add</code> method should look very familiar üòÅ. Let‚Äôs look at the bytecode for <code class="language-plaintext highlighter-rouge">execute</code> method which only invokes <code class="language-plaintext highlighter-rouge">add</code> method-</p> <ol> <li><strong>aload_0</strong> copies the value from slot 0 of LocalVariableTable to the stack. Slot 0 of LocalVariableTable contains <code class="language-plaintext highlighter-rouge">this</code>, which means stack top now contains <code class="language-plaintext highlighter-rouge">this</code></li> <li>Now is the time to invoke the private method <code class="language-plaintext highlighter-rouge">add</code> of the same class. <strong>invokevirtual</strong> is used for invoking a virtual method and, it takes a parameter which is a reference to an entry in the constant pool. Let‚Äôs see how does this entry get used - <ul> <li>Entries in constant pool are composable, which means an entry could be created by referring to other entries</li> <li>#7 is a method reference entry which refers to #8 and #9</li> <li>#8 refers to an entry #10 which specifies the name of the class <code class="language-plaintext highlighter-rouge">org/sample/AdditionExample</code></li> <li>#9 refers to entries #11 and #12 which specify the method name <code class="language-plaintext highlighter-rouge">add</code> along with its signature <code class="language-plaintext highlighter-rouge">()I</code> (<em>no parameters, integer return type</em>) respectively</li> <li>#7 in short, provides a complete signature of the <code class="language-plaintext highlighter-rouge">add</code> method including its class name <code class="language-plaintext highlighter-rouge">org/sample/AdditionExample.add:()I</code></li> </ul> </li> <li>Our stack contains <code class="language-plaintext highlighter-rouge">this</code> which will be used for invoking <code class="language-plaintext highlighter-rouge">add</code> method</li> <li><strong>invokevirtual</strong> pops the entry from stack top which is <code class="language-plaintext highlighter-rouge">this</code>, invokes <code class="language-plaintext highlighter-rouge">add</code> method and stores the result in stack top</li> <li><strong>ireturn</strong> takes the value from stack top and returns an integer</li> </ol> <p><em>javap by default does not return the output for private methods, use -p flag to see the output for private methods.</em></p> <p>One of the questions that is worth answering is ‚Äúhow does <strong>invokevirtual</strong> know about the number entries to be popped out?‚Äù. In order to answer this, we will modify our previous example slightly and see the behavior of <strong>invokevirtual</strong>.</p> <p><strong>MethodInvocation with parameters</strong></p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AdditionExample</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">add</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">20</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span> <span class="n">addend</span><span class="o">,</span> <span class="kt">int</span> <span class="n">augend</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">addend</span> <span class="o">+</span> <span class="n">augend</span><span class="o">;</span>
    <span class="o">}</span></code></pre></figure> <p><strong>bytecode (MethodInvocation with parameters)</strong></p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AdditionExample</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">AdditionExample</span><span class="o">();</span>
        <span class="nl">Code:</span>
            <span class="o">....</span>
    
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">execute</span><span class="o">();</span>
        <span class="nl">Code:</span>
            <span class="mi">0</span><span class="o">:</span> <span class="n">aload_0</span>
            <span class="mi">1</span><span class="o">:</span> <span class="n">bipush</span>        <span class="mi">10</span>
            <span class="mi">3</span><span class="o">:</span> <span class="n">bipush</span>        <span class="mi">20</span>
            <span class="mi">5</span><span class="o">:</span> <span class="n">invokevirtual</span> <span class="err">#</span><span class="mi">7</span>       <span class="c1">// Method add:(II)I</span>
            <span class="mi">8</span><span class="o">:</span> <span class="n">ireturn</span>
    
    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">add</span><span class="o">(</span><span class="kt">int</span><span class="o">,</span> <span class="kt">int</span><span class="o">);</span>
        <span class="nl">Code:</span>
            <span class="o">...</span>
<span class="o">}</span></code></pre></figure> <p>Let‚Äôs look at the bytecode for <code class="language-plaintext highlighter-rouge">execute</code> method again -</p> <ol> <li><code class="language-plaintext highlighter-rouge">this</code> is pushed on the stack, followed by push of values 10 and 20</li> <li>Stack contains <code class="language-plaintext highlighter-rouge">this</code>, <code class="language-plaintext highlighter-rouge">10</code> and <code class="language-plaintext highlighter-rouge">20</code></li> <li>There is a change in signature of the method which will be invoked by <strong>invokevirtual</strong>. <code class="language-plaintext highlighter-rouge">add</code> now takes 2 integer parameters and returns an integer. Method signature is denoted by <code class="language-plaintext highlighter-rouge">add:(II)I</code></li> <li><strong>invokevirtual</strong> now needs to pop 3 entries from the stack, 2 integers which were pushed using <strong>bipush</strong> opcode and a reference to <code class="language-plaintext highlighter-rouge">this</code> which was pushed using <strong>aload_0</strong></li> <li>Once it pops the entries, <code class="language-plaintext highlighter-rouge">add</code> method is invoked and, the result is stored in stack top</li> <li><strong>ireturn</strong> takes the value from stack top and returns an integer</li> </ol> <p>Effectively, <strong>invokevirtual</strong> knows the number of entries to be popped based on the signature of the method to be invoked. As seen in previous example, in order to invoke a method which takes 2 parameters, we need to pop 2 values from the stack along with an instance of the current class.</p> <p>Quick summary of opcodes that we have seen so far -</p> <table> <thead> <tr> <th>Opcode</th> <th>Purpose</th> </tr> </thead> <tbody> <tr> <td>aload_slot</td> <td>Copies the address value from a defined slot of LocalVariableTable to the stack, <code class="language-plaintext highlighter-rouge">a</code> stands for address</td> </tr> <tr> <td>invokevirtual</td> <td>Invokes virtual method, pops the entries from stack based on the signature of the method to be invoked</td> </tr> </tbody> </table> <h3 id="opcodes-for-object-creation">Opcodes for object creation</h3> <p>Let‚Äôs take an example to understand the bytecode that gets generated during object creation.</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Date</span> <span class="n">publishingDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">///</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nc">Date</span> <span class="nf">publishingDate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">Date</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure> <p>This example uses <code class="language-plaintext highlighter-rouge">java.util.Date</code>, (don‚Äôt ask why) and returns a <code class="language-plaintext highlighter-rouge">new Date</code> as a part of <code class="language-plaintext highlighter-rouge">publishingDate</code> method (again, don‚Äôt ask why üòÅ).</p> <p><strong>bytecode (Object creation)</strong></p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
<span class="kd">public</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Date</span> <span class="nf">publishingDate</span><span class="o">();</span>
    <span class="nl">Code:</span>
        <span class="mi">0</span><span class="o">:</span> <span class="k">new</span>           <span class="err">#</span><span class="mi">7</span>     <span class="c1">// class java/util/Date</span>
        <span class="mi">3</span><span class="o">:</span> <span class="n">dup</span>
        <span class="mi">4</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="mi">9</span>     <span class="c1">// Method java/util/Date."&lt;init&gt;":()V</span>
        <span class="mi">7</span><span class="o">:</span> <span class="n">areturn</span>
<span class="o">}</span></code></pre></figure> <p>This is a new territory that we are going into. Let‚Äôs understand the bytecode -</p> <ol> <li><strong>new</strong> allocates the required memory for the object but does not call the constructor. It refers to the constant pool and identifies the object which is <code class="language-plaintext highlighter-rouge">java/util/Date</code> here, and allocates the required memory</li> <li>Our stack now contains the object reference created by <strong>new</strong></li> <li>Before we understand <strong>dup</strong>, let‚Äô understand the need for it - <ul> <li>Let‚Äôs assume there is no <strong>dup</strong></li> <li>Our stack contains an object reference which means it is referring to some memory allocated by <strong>new</strong> opcode</li> <li>So far our <code class="language-plaintext highlighter-rouge">date</code> object has not been initialized. We need another opcode (invokespecial) for initializing it</li> <li><strong>invokespecial</strong> is used for invoking special methods like constructors. <strong>invokespecial</strong> refers to an entry in the constant pool (#9), resolves it to the init method of <code class="language-plaintext highlighter-rouge">java.util.Date</code> class.</li> <li><strong>invokespecial</strong> will pop the entry from stack top and invoke the <code class="language-plaintext highlighter-rouge">init</code> method of <code class="language-plaintext highlighter-rouge">java.util.Date</code>. This means our date object is fully initialized now</li> <li>But, now our stack does not contain any reference to the newly created object because it was popped by <strong>invokespecial</strong> to invoke a method which does not return anything</li> </ul> </li> <li>So, we need <strong>dup</strong> to duplicate the entry on stack top</li> <li><strong>invokespecial</strong> pops the entry from stack top, invokes the <code class="language-plaintext highlighter-rouge">init</code> method of <code class="language-plaintext highlighter-rouge">java.util.Date</code> class to initialize the object</li> <li>We now have the stack containing an object reference which refers to the fully created <code class="language-plaintext highlighter-rouge">java.util.Date</code> instance</li> <li><strong>areturn</strong> takes the value from stack top and returns <code class="language-plaintext highlighter-rouge">java.util.Date</code> address</li> </ol> <p>Following diagram represents the overall execution -</p> <div class="wp-block-image is-style-default"> <img style="padding-left: 0; max-width: 70%" src="/assets/img/pexels/new-dup.png" class="wp-image-878" /> </div> <p></p> <p>Quick summary of opcodes that we have seen so far -</p> <table> <thead> <tr> <th>Opcode</th> <th>Purpose</th> </tr> </thead> <tbody> <tr> <td>new</td> <td>Allocates the required memory for the object does not call the object constructor</td> </tr> <tr> <td>dup</td> <td>Duplicates the entry present on stack top</td> </tr> <tr> <td>invokespecial</td> <td>Invokes special methods like constructors</td> </tr> </tbody> </table> <h3 id="combining-things-together">Combining things together</h3> <p>Time to take one last example and validate our learning.</p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SumOfN</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">n</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">SumOfN</span><span class="o">(</span><span class="kt">int</span> <span class="n">n</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">n</span> <span class="o">=</span> <span class="n">n</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">sum</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">number</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="o">;</span> <span class="n">number</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">sum</span> <span class="o">=</span> <span class="n">sum</span> <span class="o">+</span> <span class="n">number</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">sum</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure> <p><strong>bytecode (SumOfN) constructor</strong></p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SumOfN</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">n</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">SumOfN</span><span class="o">(</span><span class="kt">int</span><span class="o">);</span>
        <span class="nl">Code:</span>
            <span class="mi">0</span><span class="o">:</span> <span class="n">aload_0</span>
            <span class="mi">1</span><span class="o">:</span> <span class="n">invokespecial</span> <span class="err">#</span><span class="mi">1</span>     <span class="c1">// Method java/lang/Object."&lt;init&gt;":()V</span>
            <span class="mi">4</span><span class="o">:</span> <span class="n">aload_0</span>
            <span class="mi">5</span><span class="o">:</span> <span class="n">iload_1</span>
            <span class="mi">6</span><span class="o">:</span> <span class="n">putfield</span>      <span class="err">#</span><span class="mi">7</span>     <span class="c1">// Field n:I</span>
            <span class="mi">9</span><span class="o">:</span> <span class="k">return</span>
        
        <span class="nl">LocalVariableTable:</span>
        <span class="nc">Start</span>  <span class="nc">Length</span>  <span class="nc">Slot</span>  <span class="nc">Name</span>   <span class="nc">Signature</span>
            <span class="mi">0</span>      <span class="mi">10</span>     <span class="mi">0</span>  <span class="k">this</span>   <span class="nc">Lorg</span><span class="o">/</span><span class="n">sample</span><span class="o">/</span><span class="nc">SumOfN</span><span class="o">;</span>
            <span class="mi">0</span>      <span class="mi">10</span>     <span class="mi">1</span>     <span class="n">n</span>   <span class="no">I</span>
<span class="o">}</span></code></pre></figure> <p>Let‚Äôs begin with <code class="language-plaintext highlighter-rouge">SumOfN(int)</code> constructor and understand the bytecode. Instead of going through the code first, let‚Äôs try and, figure out what might the bytecode look like by understanding what needs to be done.</p> <table style="width:100%"> <tr> <th>What needs to be done</th> <th>How can it be done</th> </tr> <tr> <td rowspan="2">We should be able to invoke the constructor of <code class="language-plaintext highlighter-rouge">java.lang.Object</code></td> <td>load <code class="language-plaintext highlighter-rouge">this</code> reference on the stack, which is what <b>aload_0</b> does</td> </tr> <tr> <td>invoke <code class="language-plaintext highlighter-rouge">init</code> method of <code class="language-plaintext highlighter-rouge">java.lang.Object</code> which is what <b>invokespecial</b> does. It pops <code class="language-plaintext highlighter-rouge">this</code> reference from stack top</td> </tr> <tr> <td rowspan="3">We should be able to store the value of <code class="language-plaintext highlighter-rouge">n</code> in class field</td> <td>load <code class="language-plaintext highlighter-rouge">this</code> reference on the stack, which is what <b>aload_0</b> does</td> </tr> <tr> <td>load the value of <code class="language-plaintext highlighter-rouge">n</code> on the stack from LocalVariableTable, which is what <b>iload_1</b> does. <code class="language-plaintext highlighter-rouge">n</code> has slot 1 in LocalVariableTable</td> </tr> <tr> <td>put the value of <code class="language-plaintext highlighter-rouge">n</code> in class field, which is what <b>putfield</b> does. It pops the 2 entries from stack top, one is <code class="language-plaintext highlighter-rouge">this</code> and other is the value of <code class="language-plaintext highlighter-rouge">n</code> and sets the class field</td> </tr> </table> <p>All these opcodes make up our constructor. Let‚Äôs now jump to the <code class="language-plaintext highlighter-rouge">sum</code> method.</p> <p><strong>bytecode (SumOfN) sum method</strong></p> <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">int</span> <span class="nf">sum</span><span class="o">();</span>
    <span class="nl">Code:</span>
        <span class="mi">0</span><span class="o">:</span> <span class="n">iconst_0</span>
        <span class="mi">1</span><span class="o">:</span> <span class="n">istore_1</span>
        <span class="mi">2</span><span class="o">:</span> <span class="n">iconst_1</span>
        <span class="mi">3</span><span class="o">:</span> <span class="n">istore_2</span>
        <span class="mi">4</span><span class="o">:</span> <span class="n">iload_2</span>
        <span class="mi">5</span><span class="o">:</span> <span class="n">aload_0</span>
        <span class="mi">6</span><span class="o">:</span> <span class="n">getfield</span>      <span class="err">#</span><span class="mi">7</span>     <span class="c1">// Field n:I</span>
        <span class="mi">9</span><span class="o">:</span> <span class="n">if_icmpgt</span>     <span class="mi">22</span>
        <span class="mi">12</span><span class="o">:</span> <span class="n">iload_1</span>
        <span class="mi">13</span><span class="o">:</span> <span class="n">iload_2</span>
        <span class="mi">14</span><span class="o">:</span> <span class="n">iadd</span>
        <span class="mi">15</span><span class="o">:</span> <span class="n">istore_1</span>
        <span class="mi">16</span><span class="o">:</span> <span class="n">iinc</span>          <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span>
        <span class="mi">19</span><span class="o">:</span> <span class="k">goto</span>          <span class="mi">4</span>
        <span class="mi">22</span><span class="o">:</span> <span class="n">iload_1</span>
        <span class="mi">23</span><span class="o">:</span> <span class="n">ireturn</span>

    <span class="nl">LocalVariableTable:</span>
    <span class="nc">Start</span>  <span class="nc">Length</span>  <span class="nc">Slot</span>  <span class="nc">Name</span>   <span class="nc">Signature</span>
        <span class="mi">4</span>      <span class="mi">18</span>     <span class="mi">2</span>  <span class="n">number</span>   <span class="no">I</span>
        <span class="mi">0</span>      <span class="mi">24</span>     <span class="mi">0</span>  <span class="k">this</span>     <span class="nc">Lorg</span><span class="o">/</span><span class="n">sample</span><span class="o">/</span><span class="nc">SumOfN</span><span class="o">;</span>
        <span class="mi">2</span>      <span class="mi">22</span>     <span class="mi">1</span>  <span class="n">sum</span>      <span class="no">I</span></code></pre></figure> <table style="width:100%"> <tr> <th width="30%">What needs to be done</th> <th width="30%">Code snippet</th> <th width="40%">How can it be done</th> </tr> <tr> <td>Initialize <code class="language-plaintext highlighter-rouge">sum</code> with a value 0</td> <td>int sum = 0</td> <td><b>iconst_0</b> and <b>istore_1</b> should be able to put 0 on the stack and assign it to local variable sum. <code class="language-plaintext highlighter-rouge">sum</code> variable has slot 1 in LocalVariableTable</td> </tr> <tr> <td>Initialize <code class="language-plaintext highlighter-rouge">number</code> with a value 1</td> <td>int number = 1</td> <td><b>iconst_1</b> and <b>istore_2</b> should be able to put 1 on the stack and assign it to local variable number. <code class="language-plaintext highlighter-rouge">number</code> variable has slot 2 in LocalVariableTable</td> </tr> <tr> <td>We should be able to compare the value of <code class="language-plaintext highlighter-rouge">number</code> and the value of the class field <code class="language-plaintext highlighter-rouge">n</code>. In order for this to happen, we need to load the value of <code class="language-plaintext highlighter-rouge">number</code> and <code class="language-plaintext highlighter-rouge">this</code> reference on the stack. We need <code class="language-plaintext highlighter-rouge">this</code> reference to be able to get the value of instance variable <code class="language-plaintext highlighter-rouge">n</code></td> <td>number &lt;= this.n</td> <td><b>iload_2</b> and <b>aload_0</b> should be able to copy the value of <code class="language-plaintext highlighter-rouge">number</code> variable from slot 2 and <code class="language-plaintext highlighter-rouge">this</code> reference from slot 0 on the stack</td> </tr> <tr> <td>We should be able get the value of class field <code class="language-plaintext highlighter-rouge">n</code></td> <td>this.n</td> <td><b>getfield</b> should be able to help here. It pops the class instance to get the field value. The field value goes on the stack. Now, our stack contains value of number and n</td> </tr> <tr> <td>Perform the required comparison. If the condition indicates exit from the loop, return the value present on the stack top</td> <td>number &lt;= this.n</td> <td><b>if_icmpgt</b> does the integer comparison. It pops the top 2 integer values from the stack and does the comparison (number &gt; n). If condition returns true, it takes an argument which is the instruction offset to jump to</td> </tr> <tr> <td>If the condition indicates loop continuation, load the value of <code class="language-plaintext highlighter-rouge">sum</code> and <code class="language-plaintext highlighter-rouge">number</code> variable to be able to perform addition</td> <td>sum + number</td> <td><b>iload_1</b> and <b>iload_2</b> should do it. Now our stack has 2 values which are ready for addition</td> </tr> <tr> <td>Perform addition</td> <td>sum + number</td> <td><b>iadd</b> does the integer addition. Pops the top 2 values from the stack and puts the result back in the stack</td> </tr> <tr> <td>Assign the result of addition to the variable <code class="language-plaintext highlighter-rouge">sum</code></td> <td>sum = sum + number</td> <td><b>istore_1</b> would do the job. It takes the value from stack top and assign the value in variable sum</td> </tr> <tr> <td>Increment the value of <code class="language-plaintext highlighter-rouge">number</code></td> <td>number = number + 1</td> <td><b>iinc</b> does integer increment and takes 2 parameters. First one is the LocalVariableTable slot and other one is the increment. It is one of the opcodes that does not work with stack. It increments the value at a specific slot in LocalVariableTable</td> </tr> <tr> <td>Repeat steps</td> <td>NA</td> <td><b>goto</b> is the opcode which transfers the control to a specific instruction set</td> </tr> </table> <p>Following diagram represents the overall execution of <code class="language-plaintext highlighter-rouge">sum</code> method -</p> <div class="wp-block-image is-style-default"> <img style="padding-left: 0; max-width: 130%" src="/assets/img/pexels/combining-things-together.png" class="wp-image-878" /> </div> <p></p> <h3 id="summary">Summary</h3> <p>Let‚Äôs conclude with some key takeaways -</p> <ul> <li>javap provides a human-readable format of class file</li> <li>Each opcode in a bytecode is represented by 1 byte</li> <li>Each opcode is prefixed with a letter indicating the data type the opcode will work with</li> <li>Most of the opcodes work with the stack which means before they operate, values need to be brought on the stack</li> <li>Opcode like <strong>iinc</strong> works with LocalVariableTable instead of working with values on the stack</li> <li>Opcodes like <strong>invokevirtual</strong>, <strong>invokespecial</strong> refer to an entry in the constant pool to resolve the method that needs to be invoked</li> <li>Some opcodes also have shortcuts. eg; <strong>iconst_0</strong> pushes 0 on the stack without taking any argument. It could have been designed to take an argument but that would have meant the total instruction size will be greater than 1 byte (1 byte for the opcode and another byte for the argument). In order to avoid increasing the size of the instruction, it is designed in a shortcut form</li> </ul> <p>Hope it was meaningful. Appreciate the feedback.</p> <h3 id="references">References</h3> <ul> <li><a href="https://www.jrebel.com/blog/java-bytecode-tutorial">Advanced Java Bytecode Tutorial</a></li> <li><a href="https://www.jrebel.com/blog/using-objects-and-calling-methods-in-java-bytecode">Java Bytecode: Using Objects and Calling Methods</a></li> <li><a href="https://www.youtube.com/watch?v=e2zmmkc5xI0">Java Bytecode Crash Course</a></li> <li><a href="https://www.amazon.in/Optimizing-Java-Techniques-Application-Performance/dp/9352137132">Optimizing Java - practical techniques for improving JVM application performance</a></li> </ul> </section> <!-- Social media shares --> <div class="share-buttons"> <ul class="share-buttons"> <div class="meta">Share</div> <li> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Ftech-lessons.in%2Fdiving-into-java-bytecode%2F" target="_blank" title=" Facebook"> <i class="fa fa-facebook-square fa-2x" aria-hidden="true"></i> <span class="sr-only">Share on Facebook</span> </a> </li> <li> <a href="https://twitter.com/intent/tweet?text=Diving+into+Java+Bytecode%20https%3A%2F%2Ftech-lessons.in%2Fdiving-into-java-bytecode%2F" target="_blank" title=""> <i class="fa fa-twitter-square fa-2x" aria-hidden="true"></i> <span class="sr-only">Tweet</span> </a> </li> <li> <a href="http://www.linkedin.com/shareArticle?mini=true&url=https://tech-lessons.in/diving-into-java-bytecode/&title=Diving+into+Java+Bytecode%20%7C%20tech-lessons.in&summary=&source=https://tech-lessons.in/diving-into-java-bytecode/" target="_blank" title=" LinkedIn"> <i class="fa fa-linkedin fa-2x" aria-hidden="true"></i> <span class="sr-only">Share on LinkedIn</span> </a> </li> </ul> </div> <!-- Tag list --> <footer> <div class="tag-list"> <div class="meta">Tags</div> <a class="button" href="/tags#Bytecode"> <p><i class="fa fa-tag fa-fw"></i> Bytecode</p> </a> <a class="button" href="/tags#JVM"> <p><i class="fa fa-tag fa-fw"></i> JVM</p> </a> <a class="button" href="/tags#Java"> <p><i class="fa fa-tag fa-fw"></i> Java</p> </a> </div> </footer> </article> <!-- Disqus --> <div class="comments"> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_shortname = 'techlessons'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript>Please enable JavaScript to view comments.</noscript> </div> <!-- Post navigation --> <div id="post-nav"> <div id="next-post"> <a alt="AWS Lambda - A Virtual Podcast" href="/aws-lambda-a-virtual-podcast/"> <p>Next post</p> AWS Lambda - A Virtual Podcast </a> </div> </div> <!-- To change color of links in the page --> <style> header#main { background-repeat:no-repeat; background-image: url('/assets/img/pexels/diving-into-java-bytecode.png'); } </style> </div> <footer class="site-footer"> <p class="text"> tech-lessons.in ¬© 2020. All Rights Reserved. Powered by <a href='https://jekyllrb.com/'>Jekyll</a> </p> <div class="footer-icons"> <ul> <li> <a href="https://github.com/sarthakmakhija" title="Follow on GitHub"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://www.linkedin.com/in/sarthak-makhija-7a165a55/" title="Follow on LinkedIn"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i> </span> </a> </li> </ul> <ul> </ul> </div> </footer> </body> </html>
