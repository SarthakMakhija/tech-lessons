<!DOCTYPE html> <!-- Type on Strap jekyll theme v2.0.0 Copyright 2016-2019 Sylhare Theme free for personal and commercial use under the MIT license https://github.com/sylhare/Type-on-Strap/blob/master/LICENSE --> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"> <!-- CSS --> <link rel="stylesheet" href="/assets/css/main.css"> <!--Favicon--> <link rel="shortcut icon" href="/assets/favicon.png" type="image/x-icon"> <!-- Canonical --> <link rel="canonical" href="https://sarthakmakhija.github.io/kotlin-dsl/"> <!-- KaTeX 0.8.3 --> <!-- if you have any issue check https://github.com/KaTeX/KaTeX --> <!-- Google Analytics --> <!-- End Google Analytics --> <!-- seo tags --> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>Kotlin DSL | tech-lessons.in</title> <meta name="generator" content="Jekyll v3.8.5" /> <meta property="og:title" content="Kotlin DSL" /> <meta name="author" content="Sarthak Makhija" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="A domain-specific language (DSL) is a computer language specialized to a particular application domain. This is in contrast to a general-purpose language (GPL), which is broadly applicable across domains. There are a wide variety of DSLs, ranging from widely used languages for common domains, such as HTML for web pages, down to languages used by only one or a few pieces of software. Let’s explore DSL in Kotlin together." /> <meta property="og:description" content="A domain-specific language (DSL) is a computer language specialized to a particular application domain. This is in contrast to a general-purpose language (GPL), which is broadly applicable across domains. There are a wide variety of DSLs, ranging from widely used languages for common domains, such as HTML for web pages, down to languages used by only one or a few pieces of software. Let’s explore DSL in Kotlin together." /> <link rel="canonical" href="https://sarthakmakhija.github.io/kotlin-dsl/" /> <meta property="og:url" content="https://sarthakmakhija.github.io/kotlin-dsl/" /> <meta property="og:site_name" content="tech-lessons.in" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2018-05-27T17:29:36+05:30" /> <script type="application/ld+json"> {"description":"A domain-specific language (DSL) is a computer language specialized to a particular application domain. This is in contrast to a general-purpose language (GPL), which is broadly applicable across domains. There are a wide variety of DSLs, ranging from widely used languages for common domains, such as HTML for web pages, down to languages used by only one or a few pieces of software. Let’s explore DSL in Kotlin together.","author":{"@type":"Person","name":"Sarthak Makhija"},"@type":"BlogPosting","url":"https://sarthakmakhija.github.io/kotlin-dsl/","headline":"Kotlin DSL","dateModified":"2018-05-27T17:29:36+05:30","datePublished":"2018-05-27T17:29:36+05:30","mainEntityOfPage":{"@type":"WebPage","@id":"https://sarthakmakhija.github.io/kotlin-dsl/"},"@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> <!-- Manual seo tags --> <!-- <title>Kotlin DSL | tech-lessons.in</title> <meta name="description" content="A domain-specific language (DSL) is a computer language specialized to a particular application domain. This is in contrast to a general-purpose language (GP..."> --> </head> <script defer=true src="/assets/js/main.min.js"></script> <body> <header class="site-header"> <!-- Toggle menu --> <nav class="clear"> <a aria-label="pull" id="pull" class="toggle" href="#"> <i class="fa fa-bars fa-lg"></i> </a> <!-- Menu --> <ul class="hide"> <li class="separator"> |</li> <li> <a class="clear" aria-label="Home" title="Home" href="/"> Home </a> </li> <li class="separator"> |</li> <li> <a class="clear" aria-label="About Me" title="About Me" href="/about/"> About Me </a> </li> <li class="separator"> |</li> <li> <a class="clear" aria-label="Search" title="Search" href="/search/"> <i class="fa fa-search" aria-hidden="true"></i> </a> </li> <li class="separator"> |</li> <li> <a class="clear" aria-label="Tags" title="Tags" href="/tags/"> <i class="fa fa-tags" aria-hidden="true"></i> </a> </li> </ul> </nav> </header> <div class="content"> <meta property="og:url" content="/kotlin-dsl/" /> <meta property="og:type" content="article" /> <meta property="og:title" content="Kotlin DSL" /> <meta property="og:description" content="A domain-specific language (DSL) is a computer language specialized to a particular application domain. This is in contrast to a general-purpose language (GPL), which is broadly applicable across domains. There are a wide variety of DSLs, ranging ..." /> <meta property="og:image" content="assets/img/pexels/computer.jpeg" /> <article class="feature-image"> <header id="main" style=""> <h1 id="Kotlin+DSL" class="title">Kotlin DSL</h1> <div class="post-info"><a href="https://github.com/sarthakmakhija" target="_blank"> <img src="/assets/img/avatars/avatar.png"> <p class="meta"> Sarthak Makhija - May 27, 2018 </p></a></div> </header> <section class="post-content"> <p style="text-align: left;">A domain-specific language (DSL) is a computer language specialized to a particular application domain. This is in contrast to a general-purpose language (GPL), which is broadly applicable across domains. There are a wide variety of DSLs, ranging from widely used languages for common domains, such as HTML for web pages, down to languages used by only one or a few pieces of software.</p> <h3>Kotlin DSL</h3> <p style="text-align: left;">Kotlin provides first class support for DSL which allows us to express domain-specific operations much more concisely than an equivalent piece of code in a general-purpose language.</p> <p>Let's try and build a simple DSL in Kotlin -</p> <div class="highlighter-rouge"><pre class="lang:java decode:true" title="DSL">dependencies {
   compile("io.arrow-kt:arrow-data:0.7.1")
   compile("io.arrow-kt:arrow-instances-core:0.7.1")
   testCompile("io.kotlintest:kotlintest-runner-junit5:3.1.0")
}</pre></div> <p style="text-align: left;">This should be familiar to people using <em>gradle</em> as their build tool. Above DSL specifies compile and testCompile dependencies for a gradle project in very concise and expressive form.</p> <h3>How does Kotlin support DSL</h3> <p>Before we get in to Kotlin's support for DSL, let's look at lambdas in Kotlin.</p> <div class="highlighter-rouge"><pre class="lang:java decode:true" title="Lambda in Kotlin">fun buildString(action: (StringBuilder) -&gt; Unit): String {
   val sb = StringBuilder()
   action(sb)
   return sb.toString()
}
</pre></div> <p>buildString() takes a lambda as a parameter (called action) and invokes it by passing an instance of StringBuilder. Any client code which invokes buildString() will look like the below code -</p> <div class="highlighter-rouge"><pre class="lang:java decode:true" title="Invoking buildString">val str = buildString {
    it.append("Hello")
    it.append(" ")
    it.append("World")
}</pre></div> <p>A few things to note here -</p> <ul> <li>buildString() takes lambda as the last parameter. If a function takes lambda as the last parameter, Kotlin allows you to invoke the function using braces { .. }, no need of using parentheses</li> <li><strong>it </strong>is the implicit parameter available in lambda body which is an instance of StringBuilder in this example</li> </ul> <p>This information is good enough to write a <em>gradle dependencies DSL.</em></p> <h3>First Attempt at DSL</h3> <p>In order to build a gradle dependencies DSL we <em>need a function called dependencies</em> which should take a lambda of type T as a parameter where T provides compile and testCompile functions.</p> <p>Let's try -</p> <div class="highlighter-rouge"><pre class="lang:java decode:true">fun dependencies(action: (DependencyHandler) -&gt; Unit): DependencyHandler {
    val dependencies = DependencyHandler()
    action(dependencies)
    return dependencies
}

class DependencyHandler {
    fun compile(coordinate: String){
        <code style="color: darkorange">//add coordinate to some collection</code>
    }
    fun testCompile(coordinate: String){
        <code style="color: darkorange">//add coordinate to some collection</code>
    }
}</pre></div> <p>dependencies is a simple function which takes a lambda accepting an instance of DependencyHandler as an parameter and returning Unit. DependencyHandler is the type T which has compile and testCompile functions.</p> <p>Client code for the above concept will look like -</p> <div class="highlighter-rouge"><pre class="lang:java decode:true">dependencies {
    it.compile("") <code style="color: darkorange">//it is an instance of DependencyHandler</code>
    it.testCompile("")
}</pre></div> <p>Are we done? Not really. The problem is the implicit parameter <strong>it </strong>used in the client code. Can we remove <strong>it</strong>? In order to remove implicit parameter, we need to look at "Lambda With Receiver".</p> <h3>Lambda With Receiver</h3> <p>Receiver is a simple type in Kotlin which is extended.</p> <p>Let's see this with an example -</p> <div class="highlighter-rouge"><pre class="lang:default decode:true">fun String.lastChar() : Char =
                   this.toCharArray().get(this.length - 1)</pre></div> <p>We have extended String to have lastChar() as a function which means we can always invoke it as -</p><pre class="lang:default decode:true ">"Kotlin".lastChar()</pre><p><em>Here, <span style="text-decoration: underline;">String is the receiver type</span> and <span style="text-decoration: underline;">this</span> used in the body of lastChar() is the receiver object. </em>Can we combine these 2 concepts - lambda and receiver?</p> <p>Let's rewrite our buildString function using lambda with receiver -</p> <div class="highlighter-rouge"><pre class="lang:java decode:true ">fun buildString(action: StringBuilder.() -&gt; Unit): String {
    val sb = StringBuilder()
    sb.action()
    return sb.toString()
}</pre></div> <p>A few things to note here -</p> <ul> <li>buildString() takes a lambda with receiver as an parameter</li> <li>StringBuilder is the receiver type in the lambda</li> <li>the way we invoke action function is different this time. Because <strong>action</strong> is an extension function on StringBuilder we invoke it using <strong>sb.action()</strong>, where sb is an instance of StringBuilder</li> </ul> <p>Let's create a client of buildString function -</p> <div class="highlighter-rouge"><pre class="lang:java decode:true">val str = buildString {
    this.append("Hello") <code style="color: darkorange">//this here is an instance of StringBuilder</code>
    append(" ")
    append("World")
}</pre></div> <p>Isn't this brilliant? Client code will always have access to <strong>this</strong> while invoking a function which takes <em>lambda with receiver</em> as a parameter.</p> <p>Shall we rewrite our <em>gradle</em> <em>dependencies DSL</em> code?</p> <h3>Another Attempt at DSL</h3> <div class="highlighter-rouge"><pre class="lang:java decode:true">fun dependencies(action: DependencyHandler.() -&gt; Unit): DependencyHandler {
    val dependencies = DependencyHandler()
    dependencies.action()
    return dependencies
}

class DependencyHandler {
    fun compile(coordinate: String){
        <code style="color: darkorange">//add coordinate to some collection</code>
    }
    fun testCompile(coordinate: String){
        <code style="color: darkorange">//add coordinate to some collection</code>
    }
}</pre></div> <p>The only change we have done here is in <em>dependencies</em> function which <em>takes a lambda with receiver as the parameter</em>. <em>DependencyHandler is the receiver type</em> in <em>action</em> parameter which means the <em>client code will always have access to the instance of DependencyHandler.</em></p> <p>Let's see the client code -</p> <div class="highlighter-rouge"><pre class="lang:java decode:true">dependencies {
    compile("") <code style="color: darkorange">//same as this.compile("")</code>
    testCompile("")
}</pre></div> <p>We are  able to create a DSL using <em>Lambda with Receiver</em> as a parameter to a function.</p> <h3>Operator Function invoke()</h3> <p>Kotlin provides an interesting function called <strong>invoke</strong> which is an operator function. Specifying invoke operator on a class allows it to be called on <strong>any instances of the class without a method name</strong>.</p> <p>Let's see this in action -</p> <div class="highlighter-rouge"><pre class="lang:java decode:true ">class Greeter(val greeting: String) {
    operator fun invoke(name: String) {
        println("$greeting $name")
    }
}

fun main(args: Array&lt;String&gt;) {
    val greeter = Greeter(greeting = "Welcome")
    greeter(name = "Kotlin")  <code style="color: darkorange">//this calls the invoke function which takes String as a parameter</code>
}</pre></div> <p>A few things to note about <strong>invoke()</strong> here -</p> <ul> <li>is an operator function</li> <li>takes parameter</li> <li>can be overloaded</li> <li>is being called on the instance of Greeter class without method name</li> </ul> <p>Let's use <strong>invoke</strong> in building DSL -</p> <h3>Building DSL using invoke function</h3> <div class="highlighter-rouge"><pre class="lang:java decode:true">class DependencyHandler {
    fun compile(coordinate: String){
        <code style="color: darkorange">//add coordinate to some collection</code>
    }
    fun testCompile(coordinate: String){
        <code style="color: darkorange">//add coordinate to some collection</code>
    }
    operator fun invoke(action: DependencyHandler.() -&gt; Unit): DependencyHandler {
        this.action()
        return this
    }
}</pre></div> <p>We have defined an <em>operator function in DependencyHandler which takes a lambda with receiver as a parameter</em>. This means <strong>invoke</strong> will automatically be called on instance(s) of DependencyHandler and client code will have access to instance of DependencyHandler.</p> <p>Let's write the client code -</p> <div class="highlighter-rouge"><pre class="lang:java decode:true">val dependencies = DependencyHandler()
dependencies { //as good as dependencies.invoke(..)
   compile("")
   testCompile("")
}</pre></div> <p>invoke() can come in handy while building DSL.</p> <h3>Conclusion</h3> <ul> <li>Kotlin provides a first class support for DSL which is type safe</li> <li>One can create a DSL in Kotlin using - <ul> <li>Lambda as function parameters</li> <li>Lambda With Receiver as function parameter</li> <li>operator function invoke along with Lambda With Receiver as function parameter</li> </ul> </li> </ul> <h3>References</h3> <ul> <li>Kotlin In Action</li> </ul> </section> <!-- Social media shares --> <div class="share-buttons"> <ul class="share-buttons"> <div class="meta">Share</div> <li> <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fsarthakmakhija.github.io%2Fkotlin-dsl%2F" target="_blank" title=" Facebook"> <i class="fa fa-facebook-square fa-2x" aria-hidden="true"></i> <span class="sr-only">Share on Facebook</span> </a> </li> <li> <a href="https://twitter.com/intent/tweet?text=Kotlin+DSL%20https%3A%2F%2Fsarthakmakhija.github.io%2Fkotlin-dsl%2F" target="_blank" title=""> <i class="fa fa-twitter-square fa-2x" aria-hidden="true"></i> <span class="sr-only">Tweet</span> </a> </li> <li> <a href="http://www.linkedin.com/shareArticle?mini=true&url=https://sarthakmakhija.github.io/kotlin-dsl/&title=Kotlin+DSL%20%7C%20tech-lessons.in&summary=&source=https://sarthakmakhija.github.io/kotlin-dsl/" target="_blank" title=" LinkedIn"> <i class="fa fa-linkedin fa-2x" aria-hidden="true"></i> <span class="sr-only">Share on LinkedIn</span> </a> </li> </ul> </div> <!-- Tag list --> <footer> <div class="tag-list"> <div class="meta">Tags</div> <a class="button" href="/tags#DSL"> <p><i class="fa fa-tag fa-fw"></i> DSL</p> </a> <a class="button" href="/tags#Domain+Specific+Language"> <p><i class="fa fa-tag fa-fw"></i> Domain Specific Language</p> </a> <a class="button" href="/tags#Kotlin"> <p><i class="fa fa-tag fa-fw"></i> Kotlin</p> </a> </div> </footer> </article> <!-- Disqus --> <div class="comments"> <div id="disqus_thread"></div> <script type="text/javascript"> var disqus_shortname = 'techlessons'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); </script> <noscript>Please enable JavaScript to view comments.</noscript> </div> <!-- Post navigation --> <div id="post-nav"> <div id="previous-post"> <a alt="Invest In Blogging" href="/invest-in-blogging/"> <p>Previous post</p> Invest In Blogging </a> </div> <div id="next-post"> <a alt="Kotlin Wishlist for Java" href="/kotlin-wishlist-for-java/"> <p>Next post</p> Kotlin Wishlist for Java </a> </div> </div> <!-- To change color of links in the page --> <style> header#main { background-repeat:no-repeat; background-image: url('/assets/img/pexels/computer.jpeg'); } </style> </div> <footer class="site-footer"> <p class="text"> tech-lessons.in © 2020. All Rights Reserved. Powered by <a href='https://jekyllrb.com/'>Jekyll</a> </p> <div class="footer-icons"> <ul> <li> <a href="https://github.com/sarthakmakhija" title="Follow on GitHub"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-github fa-stack-1x fa-inverse"></i> </span> </a> </li> <li> <a href="https://www.linkedin.com/in/sarthak-makhija-7a165a55/" title="Follow on LinkedIn"> <span class="fa-stack fa-lg"> <i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i> </span> </a> </li> </ul> <ul> </ul> </div> </footer> </body> </html>
